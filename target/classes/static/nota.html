<html>
<head>
	<title>Rift</title>
  	<meta charset="UTF-8">
	<link rel="stylesheet" href="fontawesome/css/all.css">
	<link rel="stylesheet" href="/css/nota_css.css">
	<link rel="stylesheet" href="/css/menu.css">
</head>

<body onload="font()">

	<div class="header_mobile" style="right: 0px; left: 0px;">
		<i class="hamburger_icon" onclick="open_navbar()" id="hamburger"></i>
		<i class="logo_black_icon" id="logo" onclick="location.href='index.html'"></i>
		<i class="messaggi_icon" id="messaggi"></i>
		<i class="cerca_black_icon" id="cerca" onclick="location.href='Search.html'"></i>
	</div>

	<div class="header">
	
		<div class="elementi_cerca_div">
			<i class="cerca_black_icon" style="right: 0px; left: 0px; top: 5px;"></i>
			<input type="text" placeholder="Cerca..." name="cerca_input" onchange="location.href='Search.html'">
		</div>

		<i class="messaggi_icon" style="right: 0px; left: 0px; top: 10px;"></i>
	</div>

	<div class="sidenav_hamburger" style="left: 0px; top: 0px; bottom: 0px;" id="sidenav_hamburger">
		<i class="close_icon" onclick="close_navbar()"></i><br><br>

		<div class="centered_element_mobile">
			<i class="cerca_icon" style="right: 0px; left: 0px; top: 2px;"></i> 
			<a href="Search.html" class="link">Cerca</a><br> 
			
			<i class="note_icon" style="right: 0px; left: 0px; top: 2px;"></i> 
			<a href="#" class="link">Note</a><br> 
			
			<i class="libreria_icon" style="right: 0px; left: 0px; top: 2px;"></i> 
			<a href="Library.html" class="link">Libreria</a><br> 
			
			<i class="cestino_icon" style="right: 0px; left: 0px; top: 2px;"></i> 
			<a href="#" class="link">Cestino</a><br>
		</div>

		<div class="bottom_element_mobile">
			<i class="accedi_icon" style="right: 0px; left: 0px; top: 2px;"></i>
			<a href="#" class="link">Accedi</a><br> 
			
			<i class="esci_icon" style="right: 0px; left: 0px; top: 2px;"></i> 
			<a href="#" class="link" style="color: red;">Esci</a>
		</div>
	</div>

	<div class="sidenav" style="left: 0px; top: 0px; bottom: 0px;">
		<i class="logo_icon" onclick="location.href='index.html'"></i><br><br>

		<div class="centered_element_sidenav">
			<i class="note_icon" style="right: 0px; left: 0px; top: 2px;"></i> 
			<a href="#" class="link">Note</a><br> 
			
			<i class="libreria_icon" style="right: 0px; left: 0px; top: 2px;"></i> 
			<a href="Library.html" class="link">Libreria</a><br> 
			
			<i class="cestino_icon" style="right: 0px; left: 0px; top: 2px;"></i> 
			<a href="#" class="link">Cestino</a>
		</div>

		<div class="bottom_element_sidenav">
			<i class="accedi_icon" style="right: 0px; left: 0px; top: 2px;"></i>
			<a href="#" class="link">Accedi</a><br>
			
			<i class="esci_icon" style="right: 0px; left: 0px; top: 2px;"></i>
			<a href="#" class="link" style="color: red;">Esci</a>
		</div>
	</div>

	<script>
		function open_navbar() {
			document.getElementById("sidenav_hamburger").style.display = "block";
			document.getElementById("hamburger").style.visibility = "hidden";
		}

		function close_navbar() {
			document.getElementById("sidenav_hamburger").style.display = "none";
			document.getElementById("hamburger").style.visibility = "visible";
		}
	</script>

<div class="content">
<div class="home-container1">
      <input type="text" placeholder="Inserisci il titolo della nota..." id="titolo_nota">
      <img
        alt="image"
        src="icon/Check_ring_round.png"
        class="home-save"
        onclick="showConferma()"
      />
      <img
        alt="image"
        src="icon/more_horizontal.png"
        class="home-moreoption"
      />
    </div>
	
	<iframe id="output" name="textfield" src=""></iframe><br>
	<div class="container-font">
	<div class="fontName" id="fontName">
		<label for="Arial" style="font-family: arial" onclick="textfield.document.execCommand('fontName', false, 'Arial')">Arial</label>
		<label for="Cursive" style="font-family: Cursive" onclick="textfield.document.execCommand('fontName', false, 'Cursive')">Cursive</label>
		<label for="Fantasy" style="font-family: Fantasy" onclick="textfield.document.execCommand('fontName', false, 'Fantasy')">Fantasy</label>
		<label for="Nunito" style="font-family: Nunito" onclick="textfield.document.execCommand('fontName', false, 'Nunito')">Nunito</label>
		<label for="Roboto" style="font-family: Roboto" onclick="textfield.document.execCommand('fontName', false, 'Roboto')">Roboto</label>
		<label for="Sans-serif" style="font-family: Sans-serif" onclick="textfield.document.execCommand('fontName', false, 'Sans-serif')">Sans-serif</label>
		<label for="Serif" style="font-family: Serif" onclick="textfield.document.execCommand('fontName', false, 'Serif')">Serif</label>
	</div>
	
	<div class="fontHeight" id="fontHeight">
		<label for="7" style="font-family: Nunito; font-size: 15px;" onclick="textfield.document.execCommand('fontSize', false, '7')">H1</label>
		<label for="6" style="font-family: Nunito; font-size: 15px;" onclick="textfield.document.execCommand('fontSize', false, '6')">H2</label>
		<label for="5" style="font-family: Nunito; font-size: 15px;" onclick="textfield.document.execCommand('fontSize', false, '5')">H3</label>
		<label for="4" style="font-family: Nunito; font-size: 15px;" onclick="textfield.document.execCommand('fontSize', false, '4')">Testo grande</label>
		<label for="3" style="font-family: Nunito; font-size: 15px;" onclick="textfield.document.execCommand('fontSize', false, '3')">Testo normale</label>
		<label for="2" style="font-family: Nunito; font-size: 15px;" onclick="textfield.document.execCommand('fontSize', false, '2')">Testo piccolo</label>
		<label for="1" style="font-family: Nunito; font-size: 15px;" onclick="textfield.document.execCommand('fontSize', false, '1')">Citazione</label>
	</div>
	
	<div class="fontColor" id="fontColor">
		<span id="#f54542" onclick="textfield.document.execCommand('foreColor', false, 'f54542')" style="width: 20px; height: 20px; border-radius: 20px; background-color: #f54542; cursor: pointer; display: inline-block;"></span>
		<span id="#f5d520" onclick="textfield.document.execCommand('foreColor', false, 'f5d520')" style="width: 20px; height: 20px; border-radius: 20px; background-color: #f5d520; cursor: pointer; display: inline-block;"></span>
		<span id="#42f56f" onclick="textfield.document.execCommand('foreColor', false, '42f56f')" style="width: 20px; height: 20px; border-radius: 20px; background-color: #42f56f; cursor: pointer; display: inline-block;"></span>
		<span id="#428af5" onclick="textfield.document.execCommand('foreColor', false, '428af5')" style="width: 20px; height: 20px; border-radius: 20px; background-color: #428af5; cursor: pointer; display: inline-block;"></span>
		<span id="#e942f5" onclick="textfield.document.execCommand('foreColor', false, 'e942f5')" style="width: 20px; height: 20px; border-radius: 20px; background-color: #e942f5; cursor: pointer; display: inline-block;"></span>
		<span id="#000000" onclick="textfield.document.execCommand('foreColor', false, '000000')" style="width: 20px; height: 20px; border-radius: 20px; background-color: #000000; cursor: pointer; display: inline-block;"></span>
	</div>
	</div>
	<div class="button_div">
  	<button type="button" data-cmd="fontName">
		<i class="fas fa-font" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="fontHeight">
		<i class="fas fa-text-height" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="fontColor">
		<i class="fas fa-paint-brush" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="bold">
		<i class="fas fa-bold" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="italic">
		<i class="fas fa-italic" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="underline">
		<i class="fas fa-underline" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="copy">
		<i class="far fa-copy" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="cut">
		<i class="fas fa-cut" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="justifyLeft">
		<i class="fas fa-align-left" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="justifyCenter">
		<i class="fas fa-align-center" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="justifyRight">
		<i class="fas fa-align-right" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="justifyFull">
		<i class="fas fa-align-justify" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="insertOrderedList">
		<i class="fas fa-list-ol" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="insertUnorderedList">
		<i class="fas fa-list" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="undo">
		<i class="fas fa-undo" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="redo">
		<i class="fas fa-redo" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="insertImage">
		<i class="far fa-image" aria-hidden="true"></i>
	</button>
	<button type="button" data-cmd="createLink">
		<i class="fas fa-link" aria-hidden="true"></i>
	</button>
	</div>
	 <div class="home-conferma" id="conferma">
      <label class="home-domanda">
        Vuoi pubblicare la nota sul portale Rif, rendendola visibile anche agli
        altri utenti?
      </label>
      <div class="home-risposte">
        <label class="home-pubblica" onclick="hideConferma(true)">Pubblica</label>
        <label class="home-nonpubblicare" onclick="hideConferma(false)">Non pubblicare</label>
      </div>
      	<label class="annulla" onclick="exitConferma()">Annulla operazione</label>
    </div>
	</div>
	
	<script src="http://cdn.jsdelivr.net/g/filesaver.js"></script>
	<script>
	function showConferma(){
		document.getElementById("conferma").style.display = "flex";
	}
	
	function hideConferma(visibilità){
		var nameFile = document.getElementById('titolo_nota').value;
		var frameContent = document.getElementById('output').contentWindow.document.body.innerHTML;
		var file = new File([frameContent], nameFile+".html", {type: "text/plain;charset=utf-8"});		
		getBase64(file,nameFile,visibilità);
		document.getElementById("conferma").style.display = "none";	
	}
	
	function exitConferma(){
		document.getElementById("conferma").style.display = "none";
	}
	
	function fontPanel(id){
		switch(id){
		case "fontName":
			document.getElementById("fontColor").style.display = "none";
			document.getElementById("fontHeight").style.display = "none";
			if(document.getElementById(id).style.display == "block"){
				document.getElementById(id).style.display = "none";
			}else{
				document.getElementById(id).style.display = "block";
			}
			break;
		case "fontColor":
			document.getElementById("fontName").style.display = "none";
			document.getElementById("fontHeight").style.display = "none";
			if(document.getElementById(id).style.display == "block"){
				document.getElementById(id).style.display = "none";
			}else{
				document.getElementById(id).style.display = "block";
			}
			break;
		case "fontHeight":
			document.getElementById("fontName").style.display = "none";
			document.getElementById("fontColor").style.display = "none";
			if(document.getElementById(id).style.display == "block"){
				document.getElementById(id).style.display = "none";
			}else{
				document.getElementById(id).style.display = "block";
			}
			break;
		case "all":
			document.getElementById("fontName").style.display = "none";
			document.getElementById("fontColor").style.display = "none";
			document.getElementById("fontHeight").style.display = "none";
			break;
		}	
	}
	
	
	//Converte da file a stringa (Questa è da tenere in nota.html)
	function getBase64(file,nameFile,visibilità) {
		   var reader = new FileReader();
		   reader.readAsDataURL(file);
		   reader.onload = function () {	   
			    var xhttp = new XMLHttpRequest();
				xhttp.open("POST","/creaNota?titolo="+nameFile + "&contenuto="+reader.result + "&pubblico="+visibilità, true);
				xhttp.send();
		   };
		   reader.onerror = function (error) {
		     console.log('Error: ', error);
		   };
	}

	function font(){
		var iframe = document.getElementById("output");
		var contentWindow = iframe.contentWindow,
    	contentDocument = contentWindow.document,
    	contentBody = contentDocument.body;
		contentBody.innerHTML = '<style>@import url(https://fonts.googleapis.com/css2?family=Nunito&display=swap); @import url(https://fonts.googleapis.com/css2?family=Nunito&family=Roboto&display=swap);</style>';
	};
	
	const buttons = document.querySelectorAll('button');
	textfield.document.designMode = "On";
	textfield.document.body.style.overflowWrap = "break-word";
	for(let i = 0; i < buttons.length; i++){
		buttons[i].addEventListener('click', ()=>{
			let cmd = buttons[i].getAttribute('data-cmd');
			if(buttons[i].name === "active"){
				buttons[i].classList.toggle('active');
			}
			
			if(cmd == 'fontName' || cmd == 'fontColor' || cmd == 'fontHeight'){
				if(cmd == 'fontName'){
					fontPanel("fontName");
				}
				if(cmd == 'fontColor'){
					fontPanel("fontColor");
				}
				if(cmd == 'fontHeight'){
					fontPanel("fontHeight");
				}
			}else{
				fontPanel("all");
				
				if(cmd == 'insertImage' || cmd == 'createLink'){
					let url = prompt('Inserisci il link che vuoi inserire', '');
					if(url != null){
						textfield.document.execCommand(cmd, false, url);
					}
				}else{
					textfield.document.execCommand(cmd, false, null);
				}
			}
		})
	}
	</script>
</body>
</html>